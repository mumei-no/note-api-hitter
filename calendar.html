<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>note æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>

  <!-- ========================================
       Bootstrap 5 (CSS)
       ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ãªã©ã«ä½¿ç”¨
  ========================================= -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- ========================================
       FullCalendar (CSS)
       ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºç”¨
  ========================================= -->
  <link
    href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css"
    rel="stylesheet"
  >

  <style>
    /* ========================================
       åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
       html, bodyã‚’100%ã«ã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”»é¢ã„ã£ã±ã„ã«
    ========================================= */
    html, body {
      height: 100%;
      margin: 0;
    }

    body {
      overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šéƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .calendar-header {
      padding: 1rem;
      border-bottom: 1px solid #dee2e6;
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ©ãƒƒãƒ‘ãƒ¼é«˜ã• */
    #calendar-wrapper {
      height: calc(100vh - 110px); /* ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†ã‚’å¼•ã„ãŸé«˜ã• */
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ã‚’è¦ªã«åˆã‚ã›ã‚‹ */
    #calendar {
      height: 100%;
    }

    /* æŠ•ç¨¿ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¿ã‚¤ãƒˆãƒ«ã®é–“éš” */
    .note-prefix {
      margin-right: 0.25em;
    }
  </style>
</head>
<body>

<!-- ========================================
     ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
     æœˆç§»å‹•ãƒœã‚¿ãƒ³ã€ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤º
========================================= -->
<div class="calendar-header">
  <h1 class="h5 mb-2">note æŠ•ç¨¿ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>

  <div class="btn-group">
    <button id="prevMonth" class="btn btn-sm btn-outline-secondary">â—€ å‰æœˆ</button>
    <button id="today" class="btn btn-sm btn-outline-secondary">ä»Šæœˆ</button>
    <button id="nextMonth" class="btn btn-sm btn-outline-secondary">æ¬¡æœˆ â–¶</button>
  </div>
</div>

<!-- ========================================
     ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“
     FullCalendarã‚’æç”»ã™ã‚‹div
========================================= -->
<div id="calendar-wrapper">
  <div id="calendar"></div>
</div>

<!-- ========================================
     ãƒ¢ãƒ¼ãƒ€ãƒ«
     ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯ã§è¨˜äº‹ã®è©³ç´°ã‚’è¡¨ç¤º
========================================= -->
<div class="modal fade" id="noteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- æ—¥ä»˜ -->
        <p class="text-muted small" id="modalDate"></p>
        <!-- noteè¨˜äº‹ãƒªãƒ³ã‚¯ -->
        <a
          id="modalLink"
          href="#"
          target="_blank"
          class="btn btn-primary btn-sm"
        >
          noteã§è¨˜äº‹ã‚’é–‹ã
        </a>
      </div>
    </div>
  </div>
</div>

<!-- ========================================
     jQuery (ç°¡å˜ãªDOMæ“ä½œã¨Ajaxã«ä½¿ç”¨)
========================================= -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- ========================================
     Bootstrap JS (ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ãƒœã‚¿ãƒ³æ“ä½œ)
========================================= -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
></script>

<!-- ========================================
     FullCalendar (ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»)
========================================= -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<!-- ========================================
     Hammer.js
     ã‚¿ãƒƒãƒæ“ä½œã«ã‚ˆã‚‹ã‚¹ãƒ¯ã‚¤ãƒ—æ¤œå‡º
========================================= -->
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>

<script>
$(function () {

  // ========================================
  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ã®åˆæœŸåŒ–
  // ========================================
  const calendarEl = document.getElementById('calendar');
  const modal = new bootstrap.Modal(document.getElementById('noteModal'));

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',    // æœˆè¡¨ç¤º
    themeSystem: 'bootstrap5',      // Bootstrapã‚¹ã‚¿ã‚¤ãƒ«
    timeZone: 'local',              // ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“è¡¨ç¤º
    headerToolbar: false,           // FullCalendarãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼éè¡¨ç¤º
    fixedWeekCount: false,          // ä½™åˆ†ãªé€±ã‚’è¡¨ç¤ºã—ãªã„

    // ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
    eventClick(info) {
      info.jsEvent.preventDefault(); // aã‚¿ã‚°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé·ç§»æŠ‘åˆ¶

      $('#modalTitle').text(info.event.title); // ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤º
      $('#modalDate').text(
        info.event.start.toLocaleString('ja-JP') // æ—¥ä»˜è¡¨ç¤º
      );
      $('#modalLink').attr('href', info.event.url); // noteãƒªãƒ³ã‚¯

      modal.show(); // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
    }
  });

  calendar.render(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»

  // ========================================
  // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³æ“ä½œ
  // ========================================
  $('#prevMonth').on('click', () => calendar.prev());
  $('#nextMonth').on('click', () => calendar.next());
  $('#today').on('click', () => calendar.today());

  // ========================================
  // ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œ
  // Hammer.jsã‚’ä½¿ç”¨
  // å·¦ã‚¹ãƒ¯ã‚¤ãƒ—: æ¬¡ã®æœˆ
  // å³ã‚¹ãƒ¯ã‚¤ãƒ—: å‰ã®æœˆ
  // ========================================
  const hammer = new Hammer(document.getElementById('calendar-wrapper'));
  hammer.on('swipeleft', () => calendar.next());
  hammer.on('swiperight', () => calendar.prev());

  // ========================================
  // RSSå–å¾—ï¼ˆrss2jsonçµŒç”±ï¼‰
  // noteã®æŠ•ç¨¿ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ 
  // feed.prefix ã§ã‚¢ã‚¤ã‚³ãƒ³åˆ†ã‘
  // ========================================
  const feeds = [
    { id: 'mumeino', prefix: 'ğŸ“' }, // ä¸€èˆ¬è¨˜äº‹
    { id: 'info', prefix: 'ğŸ“¢' }     // å…¬å¼è¨˜äº‹
  ];

  feeds.forEach(feed => {
    const rssUrl = `https://note.com/${feed.id}/rss`;
    const apiUrl =
      'https://api.rss2json.com/v1/api.json?rss_url=' +
      encodeURIComponent(rssUrl);

    $.getJSON(apiUrl, function (res) {
      if (!res.items) return;

      res.items.forEach(item => {
        calendar.addEvent({
          title: `${feed.prefix} ${item.title}`, // ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãã‚¿ã‚¤ãƒˆãƒ«
          start: new Date(item.pubDate),         // æŠ•ç¨¿æ—¥
          url: item.link,                        // noteè¨˜äº‹URL
          allDay: true                            // çµ‚æ—¥ã‚¤ãƒ™ãƒ³ãƒˆ
        });
      });
    });
  });

});
</script>

</body>
</html>
