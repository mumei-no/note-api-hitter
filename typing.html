<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Japanese Typing Game</title>

<style>
body {
  font-family: system-ui, sans-serif;
  padding: 20px;
}
#jp {
  font-size: 24px;
  margin-bottom: 8px;
}
#roma {
  color: #666;
  margin-bottom: 12px;
  word-break: break-all;
}
#input {
  font-size: 20px;
  width: 100%;
}
#status {
  margin-top: 10px;
  font-weight: bold;
}
</style>
</head>
<body>

<h1>æ—¥æœ¬èªã‚¿ã‚¤ãƒ”ãƒ³ã‚°</h1>

<div id="jp">è¾æ›¸èª­ã¿è¾¼ã¿ä¸­â€¦</div>
<div id="roma"></div>

<input id="input" autocomplete="off" />
<div id="status"></div>

<!-- âœ… wanakanaï¼ˆjsDelivr CDNï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/wanakana@5.3.1/umd/wanakana.min.js"></script>

<!-- kuromojiï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ -->
<script src="./kuromoji.js"></script>

<script>
/* ======================================
   å‡ºé¡Œãƒ†ã‚­ã‚¹ãƒˆï¼ˆä»®ï¼‰
   ====================================== */
const text = "ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­ã€‚";

/* ======================================
   kuromoji åˆæœŸåŒ–
   ====================================== */
kuromoji.builder({ dicPath: "./dict" }).build((err, tokenizer) => {
  if (err) {
    document.getElementById("jp").textContent = "è¾æ›¸èª­ã¿è¾¼ã¿å¤±æ•—";
    console.error(err);
    return;
  }

  // å½¢æ…‹ç´ è§£æ
  const tokens = tokenizer.tokenize(text);

  // èª­ã¿ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰ã‚’é€£çµ
  const reading = tokens
    .map(t => t.reading || t.surface_form)
    .join("");

  // ã‚«ã‚¿ã‚«ãƒŠ â†’ ã²ã‚‰ãŒãªï¼ˆå®Œå…¨æ­£è¦åŒ–ï¼‰
  const hira = wanakana.toHiragana(reading, { passRomaji: true });

  // ã²ã‚‰ãŒãª â†’ ãƒ­ãƒ¼ãƒå­—ï¼ˆæ‹—éŸ³å´©ã‚Œé˜²æ­¢ï¼‰
  const roma = wanakana.toRomaji(hira, { IMEMode: false });

  startGame(text, roma);
});

/* ======================================
   ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ æœ¬ä½“
   ====================================== */
function startGame(jpText, romaText) {
  const jp = document.getElementById("jp");
  const roma = document.getElementById("roma");
  const input = document.getElementById("input");
  const status = document.getElementById("status");

  jp.textContent = jpText;
  roma.textContent = romaText;
  input.focus();

  input.addEventListener("input", () => {
    const val = input.value;

    if (romaText.startsWith(val)) {
      status.textContent = val === romaText ? "ğŸ‰ ã‚¯ãƒªã‚¢ï¼" : "OK";
      if (val === romaText) {
        input.disabled = true;
      }
    } else {
      status.textContent = "âŒ ãƒŸã‚¹";
    }
  });
}
</script>

</body>
</html>
